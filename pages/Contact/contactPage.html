<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REDMEXSU</title>
    <link rel="stylesheet" href="../../css/componentsStyles/headerStyles.css">
    <link rel="stylesheet" href="../../css/componentsStyles/footerStyles.css">
    <link rel="stylesheet" href="../../css/Pages/contacPageStyles.css">
    <script src="/js/Components/header.js" defer></script>
</head>
<body>
    <!-- Header dinámico -->
    <header id="header-container"></header>

    <!-- Formulario de Contacto -->
    <main>
      <section class="contacto">
        <h2 class="titulo-contacto">Contacto</h2>
        <p class="descripcion-contacto">
          Estamos aquí para ayudarte. Por favor, completa el siguiente formulario y nos pondremos en contacto contigo a la brevedad.
        </p>

        <form class="formulario-contacto">
          <div class="form-group">
            <label for="nombre">Nombre<span class="requerido">*</span></label>
            <input type="text" id="nombre" name="nombre" class="form-control" required>
          </div>

          <div class="form-group">
            <label for="correo">E-mail<span class="requerido">*</span></label>
            <input type="email" id="correo" name="correo" class="form-control" required>
          </div>

          <div class="form-group">
            <label for="problematica">Problemática<span class="requerido">*</span></label>
            <input type="text" name="problematica" id="problematica" class="form-control" required>
          </div>

          <div class="form-group">
            <label for="comentario">Comentario</label>
            <textarea name="comentario" id="comentario" class="form-control" rows="6"></textarea>
          </div>

          <button type="submit" class="btn-submit">Enviar</button>
        </form>
      </section>
    </main>

    <!-- Footer dinámico -->
    <footer id="footer-container"></footer>

    <!-- JVS -->
    <script>
      fetch('../../components/footer.html')
        .then(res => res.text())
        .then(html => document.getElementById('footer-container').innerHTML = html);

      // Manejar envío del formulario
      document.querySelector('.formulario-contacto').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Obtener el botón de envío para mostrar estado de carga
        const submitBtn = this.querySelector('.btn-submit');
        const originalText = submitBtn.textContent;
        
        // Validar que los campos requeridos no estén vacíos
        const nombre = document.getElementById('nombre').value.trim();
        const correo = document.getElementById('correo').value.trim();
        const problematica = document.getElementById('problematica').value.trim();
        const comentario = document.getElementById('comentario').value.trim();
        
        if (!nombre || !correo || !problematica) {
          alert('Por favor, completa todos los campos requeridos (marcados con *)');
          return;
        }
        
        const formData = {
          nombre: nombre,
          correo: correo,
          problematica: problematica,
          comentario: comentario
        };

        try {
          // Mostrar estado de carga
          submitBtn.textContent = 'Enviando...';
          submitBtn.disabled = true;
          
          console.log('Enviando datos:', formData);
          
          const response = await fetch('https://backend-redmexsu.vercel.app/api/contacto', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          });

          console.log('Respuesta recibida:', response.status, response.statusText);

          if (response.ok) {
            const result = await response.json();
            console.log('Resultado:', result);
            
            // Verificar si el mensaje indica éxito
            if (result.message && result.message.toLowerCase().includes('success')) {
              alert('¡Mensaje enviado exitosamente! Nos pondremos en contacto contigo pronto.');
              this.reset(); // Limpiar el formulario
            } else {
              alert(`Respuesta del servidor: ${result.message || 'Mensaje enviado'}`);
              this.reset();
            }
          } else {
            // Intentar obtener el mensaje de error del servidor
            let errorMessage = `Error ${response.status}: ${response.statusText}`;
            try {
              const errorData = await response.json();
              if (errorData.message) {
                errorMessage = errorData.message;
              }
            } catch (jsonError) {
              console.error('Error al parsear respuesta de error:', jsonError);
            }
            throw new Error(errorMessage);
          }
        } catch (error) {
          console.error('Error al enviar formulario:', error);
          alert(`Hubo un error al enviar el mensaje: ${error.message}. Por favor, inténtalo de nuevo.`);
        } finally {
          // Restaurar el botón
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      });
    </script>
</body>
</html>